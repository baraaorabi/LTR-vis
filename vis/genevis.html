<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style type="text/css">
</style>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/d3-scale.v3.min.js"></script>
<script src="https://d3js.org/d3-path.v1.min.js"></script>
<script src="https://d3js.org/d3-shape.v1.min.js"></script>
</head>
<body>
    <div id="overview-container"></div>
    <div id="detail-container"></div>
<script>
d3.select(window).on("load", function() {
  d3.json("alignments.json", function(reads) {
    var scale = null;
    var canvas = d3.select("#overview-container").selectAll("svg").data(reads).enter().append("svg").attr("width", 620).attr("height", 100);
    canvas.selectAll("rect").data(function (read) {
        scale = d3.scaleLinear().domain([0, read.target_length]).range([0,600]); 
        return read.data.filter(function(d) { return d.type != "i"});
      }).enter().append("rect")
      .attr("fill", function(d) {
        if (d.type == "m")
          return "green";
        else 
          return "gray";
      })
      .attr("x", function(d) { return scale(d.start) + 10; })
      .attr("y", function(d) {
        if (d.type == "m")
          return 50;
        else 
          return 52;
      })
      .attr("width", function(d) { return scale(d.end) - scale(d.start)})
      .attr("height", function(d) {
        if (d.type == "m")
          return 6;
        else 
          return 2;
      });
    canvas.selectAll("ellipse").data(function (read) {
        return read.data.filter(function(d) { return d.type == "i"});
      }).enter().append("ellipse")
      .attr("stroke", "purple")
      .attr("fill", "white")
      .attr("cx", function(d) { return scale(d.pos) + 10; })
      .attr("cy", function(d) { return 41; })
      .attr("rx", function(d) { return 8; })
      .attr("ry", function(d) { return 12; });
    canvas.selectAll("text").data(function (read) {
        return read.data.filter(function(d) { return d.type == "i"});
      }).enter().append("text")
      .text(function(d) {return d.length; })
      .attr("font-family", "Arial")
      .attr("font-size", "8px")
      .attr("fill", "black")
      .style("text-anchor", "middle")
      .attr("x", function(d) { return scale(d.pos) + 10; })
      .attr("y", function(d) { return 45; });
  });
});
</script>
</body>
</html>